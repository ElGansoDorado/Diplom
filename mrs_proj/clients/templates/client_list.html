{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Список пациентов</title>
    <!-- Include your custom CSS file here -->
    <!-- <link rel="stylesheet" type="text/css" href="{% static 'css/clients_styles.css' %}"> -->
</head>
<body>

<!-- Main Content -->
<main>
    <h2>Список пациентов</h2>

    <!-- Add button to toggle the form -->
    <input type="text" id="searchInput" placeholder="Search by name">
    <button type="button" id="searchButton">Search</button>
<form method="get" action="{% url 'client_list' %}">
    <button type="submit">Сброс соритировки</button>
</form>

    <!-- Existing client list -->
    <table>
        <thead>
        <tr>
            <th {% if sort_by == 'last_name' %}class="active"{% endif %}><a href="?sort=last_name&order={{ next_order }}">ФИО</a></th>
            <th {% if sort_by == 'age'%}class="active"{% endif %}><a href="?sort=age&order={{ next_order }}">Возраст</a></th>
            <th {% if sort_by == 'body_mass_index'%}class="active"{% endif %}><a href="?sort=body_mass_index&order={{ next_order }}">ИМТ</a></th>
            <th {% if sort_by == 'spo2'%}class="active"{% endif %}><a href="?sort=spo2&order={{ next_order }}">SPO2</a></th>
            <th {% if sort_by == 'admission_date'%}class="active"{% endif %}><a href="?sort=admission_date&order={{ next_order }}">Дата поступления</a></th>
            <th {% if sort_by == 'result'%}class="active"{% endif %}><a href="?sort=result&order={{ next_order }}">Результат</a></th>
            <th>Действия</th>
        </tr>
        </thead>
        <tbody>
        {% for client in clients %}
        <tr>
            <td>
                <a href="{% url 'client_detail' token=client.token %}">{{ client.last_name }} {{client.first_name }} {{ client.patronymic }}</a>
            </td>
            <td>{{ client.age }}</td>
            <td>{{ client.body_mass_index }}</td>
            <td>{{ client.spo2 }}</td>
            <td>{{ client.admission_date }}</td>
            <td>{{ client.result }}</td>
            <td>
                <a href="{% url 'client_detail' token=client.token %}">Delete</a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <button id="toggleFormBtn" onclick="toggleForm()">Добавить пациента</button>

    <!-- Form to add a new client -->
    <form id="addClientForm" method="post" action="{% url 'client_list' %}" style="display: none;"
          onsubmit="return validateClientForm()">
        {% csrf_token %}
        {{ form.as_table }}
        <input type="hidden" name="action" value="save">
        <button type="submit">Сохранить</button>
        <button type="button" onclick="cancelAddClient()">Отменить</button>
    </form>

    <!-- Pagination controls -->
    <div class="pagination">
        <span class="step-links">
            {% if clients.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ clients.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ clients.number }} of {{ clients.paginator.num_pages }}.
            </span>

            {% if clients.has_next %}
                <a href="?page={{ clients.next_page_number }}">next</a>
                <a href="?page={{ clients.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>

</main>

<!-- Include your custom JS file here -->
<script src="{% static 'scripts/clients_scripts.js' %}"></script>
<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

</body>
</html>
